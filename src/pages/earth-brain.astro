---
import IndexLayout from '@/layouts/IndexLayout.astro'
import PostList from '@/components/widgets/PostList.astro'
import { themeConfig } from '@/config'
import { getSortedFilteredPosts } from '@/utils/draft'

const allPosts = await getSortedFilteredPosts()

// 1. ç­›é€‰å‡ºæ‰€æœ‰å±äºâ€œåœ°çƒå¤§è„‘â€çš„æ–‡ç« 
const brainPosts = allPosts.filter(post => 
  post.data.category === 'earth-brain' || post.data.title.includes('ğŸŒ')
)

// 2. å°†æ–‡ç« æŒ‰æ ‡ç­¾ç»†åˆ†ï¼ˆå¯¹åº”ä½ åœ¨ .md æ–‡ä»¶é‡Œå†™çš„ tagsï¼‰
const moviePosts = brainPosts.filter(post => post.data.tags?.includes('ç”µå½±'))
const gamePosts = brainPosts.filter(post => post.data.tags?.includes('æ¸¸æˆ'))
// å‰©ä¸‹çš„æ²¡æ‰“æ ‡ç­¾çš„æ”¾åœ¨â€œå…¶ä»–â€
const otherPosts = brainPosts.filter(post => !post.data.tags?.includes('ç”µå½±') && !post.data.tags?.includes('æ¸¸æˆ'))
---

<IndexLayout title="ğŸŒ åœ°çƒå¤§è„‘ | ãƒ¨ãƒ¨ã®ä¸–ç•Œ" description="æ”¾æˆ‘å–œæ¬¢çš„ä¸œè¥¿ï¼šç”µå½±ã€æ¸¸æˆã€ä¹¦">
  <div style="margin-bottom: 2rem;">
    <h1 style="font-size: 2rem; font-weight: bold;">ğŸŒ</h1>
    <p style="opacity: 0.8; margin-top: 0.5rem;">æ‰€æœ‰å–œæ¬¢çš„ä¸œè¥¿ã€‚</p>
  </div>

  <main>
    {brainPosts.length === 0 ? (
      <p style="padding: 2rem; border: 1px dashed var(--text-primary); text-align: center;">
        å¤§è„‘ç©ºè¡è¡... å¿«å» src/content/posts é‡Œå†™ç¬¬ä¸€ç¯‡ç¬”è®°å§ï¼<br/>
        (è®°å¾—åœ¨æ–‡ç« å¼€å¤´å†™ä¸Š category: earth-brain)
      </p>
    ) : (
      <>
        {/* ç”µå½±åŒºï¼šåªæœ‰å½“ä½ å†™äº†å¸¦â€œç”µå½±â€æ ‡ç­¾çš„æ–‡ç« æ‰ä¼šæ˜¾ç¤º */}
        {moviePosts.length > 0 && (
          <div class="category-section">
            <h2 class="cat-title"><img src="/movie-icon.png" class="cat-icon" /> ç”µå½±è®°å½•</h2>
            <PostList posts={moviePosts} />
          </div>
        )}

        {/* æ¸¸æˆåŒºï¼šåªæœ‰å½“ä½ å†™äº†å¸¦â€œæ¸¸æˆâ€æ ‡ç­¾çš„æ–‡ç« æ‰ä¼šæ˜¾ç¤º */}
        {gamePosts.length > 0 && (
          <div class="category-section">
            <h2 class="cat-title"><img src="/game-icon.png" class="cat-icon" /> æ¸¸æˆå­˜æ¡£</h2>
            <PostList posts={gamePosts} />
          </div>
        )}

        {/* å…¶ä»–åŒºï¼šæ²¡åˆ†ç±»çš„æ˜¾ç¤ºåœ¨è¿™é‡Œ */}
        {otherPosts.length > 0 && (
          <div class="category-section">
            <h2 class="cat-title">âœ¨ å…¶ä»–ç¢ç‰‡</h2>
            <PostList posts={otherPosts} />
          </div>
        )}
      </>
    )}
  </main>
</IndexLayout>

<style>
  .category-section {
    margin-bottom: 3rem;
    padding-top: 1rem;
  }
  .cat-title {
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 1.5rem;
    margin-bottom: 1rem;
    border-bottom: 1px solid var(--text-primary);
    padding-bottom: 0.5rem;
  }
  .cat-icon {
    width: 32px;
    height: 32px;
    object-fit: contain;
  }
</style>
